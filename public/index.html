<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>
<body><div>
    <h1>URL shortener</h1>
    <form id="shorten" >
        <label for="url">Enter the URL: 
            <input type="text" name="url" id="url">
        </label>
        <br>
        
        <label for="shortenCode">Shortened Code for URL: 
            <input type="text" name="shortenCode" id="shortenCode">
        </label><br>
        <button type="submit">Shortened</button>
    </form>
    <h3>NEW URL:-</h3>
    <ul id="urls"></ul>
</div>
<script>
    document.getElementById('shorten').addEventListener('submit',async(event)=>{
        event.preventDefault();
       // console.log(FormData);
        const data=new FormData(event.target);//formData is class which holds many methods., it target the form,in which this event is taking place 
        //console.log(data);
        const url=data.get('url')//it put the data of input field where name="url"
        const shortenCode=data.get('shortenCode');
        console.log(url,shortenCode);

        try{
            const res=await fetch('/shorten',{
                method:"POST",
                headers:{"Content-Type":"application/json"},
                body:JSON.stringify({url,shortenCode})
            })
            if(res.ok){
                alert("for submitted")
                fetchShortenURL(shortenCode);
                event.target.reset()//to reload the form.
            }
            else{
                let errorMsg=await res.text();
                alert(errorMsg)
            }
        }
        catch(error){
            console.log(error);
        }
async function  fetchShortenURL(s){
    const response=await fetch('/link')//
    const link= await response.json();//response.json() it reads the body of a Response object, parses it as JSON, and returns a Promise that resolves to a JavaScript object.  i write await, otherwise the code will excute and that line will not let the promise being fulfilled and will return a promise, promise on fulfilling sends the object
    console.log(link);//JSON.parse() takes a string and turns it into a JavaScript object.
    const list=document.getElementById("urls");
    list.innerHTML="";
    const links=Object.entries(link);
    console.log(links);
    links.forEach((i,d)=>{
        
        const[short,url]=i;
        if(short==s){
            const li=document.createElement("li");
        const truncatedURL=url.length<30 ? url : `${url.slice(0,10)}..`

        li.innerHTML=`<a href="/${short}" target="_blank">${window.location.origin}/${short}</a> - ${truncatedURL}` ;
        list.append(li);
        }

    })
    

}

    })
</script>
</body>

</html>